<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="MQTT Demo" />
<meta name="DC.relation" scheme="URI" content="GUID-52D24502-1FE3-473D-9DA1-624A4E26166B.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="mqtt-demo" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>MQTT Demo</title>
<meta name="Microsoft.Help.Id" content="GUID-E8A5D79A-26BD-49D0-91F1-794159141A29-mqtt-demo" />
<meta name="Microsoft.Help.TocParent" content="GUID-E8A5D79A-26BD-49D0-91F1-794159141A29" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLAB Harmony WINC1500 Wireless Applications Reference A 05/2023" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-AE60932A-703A-481E-817A-53DCFD93BA11"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="mqtt-demo">
<h1 class="title topictitle1" id="ariaid-title1" style="">MQTT Demo</h1><div class="body"><p class="p">This application demonstrates how a user run a MQTT Client using third party Paho software on WINC1500 device. The user would need to use "MQTT.fx" third party Mqtt Client application to receive message posted by MQTT Client running on WINC1500 device once it connects to the MQTT server.</p>
<ol class="ol"><li class="li"><span class="indent-level-default">1.</span><p class="p">Download the MQTT.fx Third Party Mqtt Client Application and open it on Laptop.</p>
</li>
<li class="li"><span class="indent-level-default">2.</span><p class="p">Connect the MQTT.fx Application to the MQTT Server - broker.hivemq.com with port 1883.</p>
<br /><img class="image" src="GUID-2B6FFE4F-9BC2-45D2-8523-BAB6F9D06A45-low.png" alt="mqtt_fx1" /><br /></li>
<li class="li"><span class="indent-level-default">3.</span><p class="p">Make the MQTT.fx Application susbcribe to Topic MCHP/Sample/a.</p>
<br /><img class="image" src="GUID-BD8C4C8A-F409-4586-AF1A-AAF9AE0FE2F3-low.png" alt="mqtt_fx2" /><br /></li>
<li class="li"><span class="indent-level-default">4.</span><p class="p">Configure the wifi parameters using "wifi set" command.</p>
<br /><img class="image" src="GUID-3C9CE2F8-D348-4ECA-8DB9-1C6988EBFB37-low.png" alt="wifi_config" /><br /></li>
<li class="li"><span class="indent-level-default">5.</span><p class="p">Enter the command "mqtt start".</p>
<br /><img class="image" src="GUID-E7BE5398-F303-47F3-89C7-375CC3351C97-low.png" alt="mqtt_start_cmd" /><br /></li>
<li class="li"><span class="indent-level-default">6.</span><p class="p">Enter the command "appdemo start 1 18". The device will connect to the network and IP address will be displayed on the terminal window. The MQTT Client on the WINC1500 device shall connect to the MQTT Server - broker.hivemq.com.</p>
<br /><img class="image" src="GUID-C48EBBD6-7B2B-4D43-88F6-B580E1224D8B-low.png" alt="mqtt_app_start" /><br /></li>
<li class="li"><span class="indent-level-default">7.</span><p class="p">After connecting to MQTT Server, the MQTT Client on the WINC1500 device shall subscribe to Topic MCHP/Sample/b.</p>
<br /><img class="image" src="GUID-3C1CD055-0CDE-4B1D-AE51-F40E81D1F7DB-low.png" alt="mqtt_subscribe_1" /><br /></li>
<li class="li"><span class="indent-level-default">8.</span><p class="p">The MQTT Client on the WINC1500 device shall publish the message "Hello" to Topic MCHP/Sample/a.</p>
<br /><img class="image" src="GUID-6A582B26-890C-4D94-858D-B9FD1DB31689-low.png" alt="mqtt_subscribe" /><br /></li>
<li class="li"><span class="indent-level-default">9.</span><p class="p">MQTT.fx Application receives the message "Hello" on the Topic MCHP/Sample/a sent by the MQTT Client running on the WINC1500.</p>
<br /><img class="image" src="GUID-18B326C2-793B-4EFF-BF6B-0A616DC3FECA-low.png" alt="mqtt_fx3" /><br /></li>
<li class="li"><span class="indent-level-default">10.</span><p class="p">Publish message from MQTT.fx Application on the Topic MCHP/Sample/b.</p>
<br /><img class="image" src="GUID-56BDC6BD-6B58-45B9-8670-AD72BA369A95-low.png" alt="mqtt_fx4" /><br /></li>
<li class="li"><span class="indent-level-default">11.</span><p class="p">The MQTT Client on the WINC1500 device receives the message on the Topic MCHP/Sample/b sent by the MQTT.fx Application running on the laptop.</p>
<br /><img class="image" src="GUID-FF96E309-25CA-4511-8EFE-EB76A6A0D252-low.png" alt="mqtt_publish_terminal" /><br /></li>
</ol>
<p class="p"><strong class="ph b">Note:</strong></p>
<p class="p">If the user wants to create a MQTT application project in Socket Mode, and wants to use the Paho for MQTT Protocol, One needs to follow the below mentioned steps</p>
<ol class="ol"><li class="li"><span class="indent-level-default">1.</span><p class="p">From the "paho.mqtt.embedded-c" repo, copy the folder "paho.mqtt.embedded-c\MQTTPacket" to "app_demos\firmware\src\third_party\paho.mqtt.embedded-c\MQTTPacket" of the new project directory.</p>
</li>
<li class="li"><span class="indent-level-default">2.</span><p class="p">From the "paho.mqtt.embedded-c" repo, copy the folder "paho.mqtt.embedded-c\MQTTClient-C" to "app_demos\firmware\src\third_party\paho.mqtt.embedded-c\MQTTClient-C" of the new project directory.</p>
</li>
<li class="li"><span class="indent-level-default">3.</span><p class="p">It is important to have the porting files "MCHP_winc.c" and "MCHP_winc.h" in the project. These porting files are available only in "wifi_socket_demo" project. Copy the folder from "wifi_socket_demos\firmware\src\third_party\paho.mqtt.embedded-c\MQTTClient-C\Platforms" to "app_demos\firmware\src\third_party\paho.mqtt.embedded-c\MQTTClient-C\Platforms" of the new project directory. Please make sure that the folder structure of the new project is same as mentioned above.</p>
</li>
</ol>
<ul class="ul"><li class="li"><p class="p">Enable MQTT</p>
</li>
</ul>
<ol class="ol"><li class="li"><span class="indent-level-default">1.</span><p class="p">User should enable the macro "WINC_MQTT" to enable the MQTT application. For this follow the steps:</p>
<ul class="ul"><li class="li with-image"><p class="p">Open project properties</p>
<br /><img class="image" src="GUID-ADBB5400-A71E-4371-863C-7594E2AA7B27-low.png" alt="mqtt_properties_1" /><br /></li>
<li class="li with-image"><p class="p">Select xc32-gcc</p>
<br /><img class="image" src="GUID-5F3A2A2A-660A-4595-BB5C-6CF7008BA905-low.png" alt="mqtt_properties_2" /><br /></li>
<li class="li with-image"><p class="p">Select "preprocessing and messages" from the "Option Categories".</p>
<br /><img class="image" src="GUID-06B8BE70-68E0-404F-B91F-A05CC2EDD5CE-low.png" alt="mqtt_properties_3" /><br /></li>
<li class="li with-image"><p class="p">Select the "add" button of "Preprocessor Macros"</p>
<br /><img class="image" src="GUID-A5C58B82-5347-42DE-9F86-2864E784FFAF-low.png" alt="mqtt_properties_4" /><br /></li>
<li class="li with-image"><p class="p">Add the macro "WINC_MQTT" and press OK.</p>
<br /><img class="image" src="GUID-92CBED7B-7DF0-4F49-8907-B40D0C77AEFE-low.png" alt="mqtt_properties_6" /><br /></li>
</ul>
</li>
</ol>
<p class="p"><a class="xref" href="#top">Back to top</a></p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-52D24502-1FE3-473D-9DA1-624A4E26166B.html">WINC1500 Socket Mode Demo Applications</a></div>
</div>
</div></body>
</html>